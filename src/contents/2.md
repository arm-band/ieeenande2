---
layout: article.ejs
title: セレクトボックスの値がおかしくなる
url: insane_selectbox
date: 2017-02-17T9:57:06+09:00
thumbnail: ie_shot.jpg
excerpt: 次の条件を満たすフォーム・操作で、セレクトボックスの値がおかしくなる。
---

### 症状

下記条件を満たすフォーム・操作で、セレクトボックスの値がおかしくなる。

#### 条件

* Windows10のIE11を使用（2/17現在、IEバージョン：11.576.14393.0）
* フォームはセレクトボックスで項目を選択、セレクトボックスの内容はラジオボタンをチェックすると、それに対応した項目のみに絞り込みされる（ラジオボタンをチェックするたびに、JSでoption要素を全削除→ラジオボタンの項目に対応するもののみ再生成している）

#### 操作

1.  IEでラジオボタンで絞り込みを行い、セレクトボックスで項目を選択（**上からn番目のAという項目**とする）
2.  項目を選択した状態で、submitで次の画面に遷移
3.  IEの「戻る」で前の画面（セレクトボックスがある画面）に戻る

すると、Windows10のIE11でのみ、ラジオボタンの絞り込みが解除され、かつ絞り込みなしの状態で**上からn番目の項目**が選択されている。

他のブラウザでは、ラジオボタンの絞り込みは解除されるのは同じだが、選択されている項目は一致している（**Aという項目が選ばれたまま**）ので、今回のケースでは大きな問題にならない。

また、Windows7のIE11（11.0.9600.18537）では発生せず、Windows10のIE11のみ現象を確認した。

## 対処（解決せず）

* [ブラウザの戻るボタンを押すと<select>の選択がおかしくなるのをjQueryで解決 – しぃぶろぐ。](http://shiranuik.hatenablog.jp/entry/2015/08/26/105539)

効果がなかった。

ということで、謎現象な上に対処が難しいので保留。History APIを弄ればなんとかなりそうな気はしないでもないが…。